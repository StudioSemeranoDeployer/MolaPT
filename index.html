<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gianluca Mola Personal Trainer</title>
    <style>
        /* Design System */
        :root {
            --primary: #208088;
            --primary-hover: #1a6870;
            --primary-light: #e8f4f6;
            --accent: #d4a574;
            --accent-light: #f5ede3;
            --success: #27ae60;
            --error: #e74c3c;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --bg: #f8f9fa;
            --surface: #ffffff;
            --border: #ecf0f1;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 16px rgba(0,0,0,0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg);
            color: var(--text);
            font-size: 16px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-behavior: smooth;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 16px;
        }

        /* Header */
        .header {
            background: var(--surface);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 24px;
            border-radius: 12px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
            flex: 1;
        }

        .lang-selector {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .lang-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lang-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .lang-btn:hover:not(.active) {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .lang-btn:active {
            transform: translateY(0);
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 24px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            font-size: 14px;
            color: var(--text-light);
            font-weight: 600;
        }

        /* Form Steps */
        .step {
            display: none;
            background: var(--surface);
            padding: 32px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading state */
        .btn.loading {
            position: relative;
            color: transparent;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .step-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .step-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .step-desc {
            font-size: 16px;
            color: var(--text-light);
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 15px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--surface);
            color: var(--text);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .form-input.error,
        .form-select.error,
        .form-textarea.error {
            border-color: var(--error);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232c3e50' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        /* Checkbox Groups */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        @media (max-width: 600px) {
            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px;
        }

        .checkbox-item:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .checkbox-item label {
            cursor: pointer;
            user-select: none;
            font-size: 15px;
        }

        /* Range Slider */
        .range-container {
            padding: 8px 0;
        }

        .range-input {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border);
            outline: none;
            -webkit-appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .range-input::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow);
        }

        .range-value {
            text-align: center;
            font-weight: 700;
            font-size: 18px;
            color: var(--primary);
            margin-top: 8px;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 140px;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--text-light);
            color: white;
        }

        .btn-secondary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Success Section */
        .success-section {
            display: none;
            text-align: center;
        }

        .success-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .success-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 32px;
        }

        .success-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-accent:hover:not(:disabled) {
            background: #c49563;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-accent:active:not(:disabled) {
            transform: translateY(0);
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .summary-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .summary-card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
        }

        .summary-item {
            margin-bottom: 12px;
        }

        .summary-label {
            font-weight: 600;
            color: var(--text-light);
            font-size: 14px;
            margin-bottom: 4px;
        }

        .summary-value {
            color: var(--text);
            font-size: 15px;
        }

        /* Radio Groups */
        .radio-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px;
            flex: 1;
            min-width: 100px;
        }

        .radio-item:hover {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .radio-item input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .radio-item label {
            cursor: pointer;
            user-select: none;
            font-size: 15px;
            flex: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .header {
                padding: 16px;
            }

            .header-content {
                flex-direction: column;
                align-items: stretch;
            }

            .logo {
                text-align: center;
                font-size: 20px;
            }

            .lang-selector {
                justify-content: center;
            }

            .step {
                padding: 20px;
            }

            .step-title {
                font-size: 20px;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                min-width: 100%;
            }

            .success-buttons {
                flex-direction: column;
            }

            .success-buttons .btn {
                width: 100%;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .radio-group {
                flex-direction: column;
            }

            .radio-item {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 15px;
            }

            .step-title {
                font-size: 18px;
            }

            .step-desc {
                font-size: 14px;
            }

            .form-input,
            .form-select,
            .form-textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .btn {
                font-size: 15px;
                padding: 12px 20px;
            }
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
            }

            .header,
            .progress-container,
            .nav-buttons,
            .success-buttons,
            .btn {
                display: none;
            }

            .summary-card {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }

        .config-notice {
            background: var(--accent-light);
            border: 2px solid var(--accent);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            font-size: 14px;
            line-height: 1.6;
        }

        .config-notice strong {
            color: var(--accent);
            display: block;
            margin-bottom: 8px;
        }

        .config-notice code {
            background: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }

        /* Disabled state for checkboxes */
        .checkbox-item input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .checkbox-item:has(input:disabled) {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .checkbox-item:has(input:disabled):hover {
            background: transparent;
            border-color: var(--border);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">üí™ Gianluca Mola Personal Trainer</div>
                <div class="lang-selector">
                    <button class="lang-btn active" data-lang="it" onclick="switchLanguage('it')">üáÆüáπ IT</button>
                    <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">üá¨üáß EN</button>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Step 1 of 9</div>
        </div>

        <!-- Step 1: Personal Info -->
        <div class="step active" id="step1">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step1_title">1. Informazioni Personali</h2>
                <p class="step-desc" data-i18n="step1_desc">Iniziamo con i tuoi dati di base</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="fullname">Nome Completo</label>
                <input type="text" class="form-input" id="fullname" required>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="email">Email</label>
                <input type="email" class="form-input" id="email" required>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="phone">Telefono</label>
                <input type="tel" class="form-input" id="phone">
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="age">Et√†</label>
                <input type="number" class="form-input" id="age" min="16" max="120" required>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="codice_fiscale">Codice Fiscale</label>
                <input type="text" class="form-input" id="codiceFiscale" required>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="gender">Genere</label>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" name="gender" value="M" id="gender_male" required>
                        <label for="gender_male" data-i18n="male">Uomo</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="gender" value="F" id="gender_female" required>
                        <label for="gender_female" data-i18n="female">Donna</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" name="gender" value="O" id="gender_other" required>
                        <label for="gender_other" data-i18n="other">Altro</label>
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 2: Health History -->
        <div class="step" id="step2">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step2_title">2. Storia Medica</h2>
                <p class="step-desc" data-i18n="step2_desc">Informazioni sulla tua salute</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="medical_conditions">Condizioni mediche</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="condition_diabetes" value="diabetes" name="conditions">
                        <label for="condition_diabetes" data-i18n="diabetes">Diabete</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="condition_hypertension" value="hypertension" name="conditions">
                        <label for="condition_hypertension" data-i18n="hypertension">Ipertensione</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="condition_heart" value="heart_disease" name="conditions">
                        <label for="condition_heart" data-i18n="heart_disease">Malattie Cardiache</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="condition_arthritis" value="arthritis" name="conditions">
                        <label for="condition_arthritis" data-i18n="arthritis">Artrite</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="condition_none" value="none" name="conditions">
                        <label for="condition_none" data-i18n="none">Nessuna</label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="medications">Farmaci attuali</label>
                <textarea class="form-textarea" id="medications"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="allergies">Allergie</label>
                <textarea class="form-textarea" id="allergies"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="surgeries">Interventi chirurgici</label>
                <textarea class="form-textarea" id="surgeries"></textarea>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 3: Fitness Goals -->
        <div class="step" id="step3">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step3_title">3. Obiettivi di Fitness</h2>
                <p class="step-desc" data-i18n="step3_desc">Quali sono i tuoi obiettivi?</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="fitness_goals">Seleziona obiettivi</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal_weight_loss" value="weight_loss">
                        <label for="goal_weight_loss" data-i18n="weight_loss">Perdere Peso</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal_muscle_gain" value="muscle_gain">
                        <label for="goal_muscle_gain" data-i18n="muscle_gain">Aumentare Massa</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal_strength" value="strength">
                        <label for="goal_strength" data-i18n="strength">Aumentare Forza</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal_endurance" value="endurance">
                        <label for="goal_endurance" data-i18n="endurance">Migliorare Resistenza</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal_flexibility" value="flexibility">
                        <label for="goal_flexibility" data-i18n="flexibility">Migliorare Flessibilit√†</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal_health" value="health">
                        <label for="goal_health" data-i18n="health">Salute Generale</label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="goal_importance">Importanza obiettivi (1-10)</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="goal_importance" min="1" max="10" value="5" oninput="updateRangeValue('goal_importance')">
                    <div class="range-value" id="goal_importance_value">5</div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="goal_timeline">Timeline</label>
                <select class="form-select" id="goal_timeline">
                    <option value="1_3mo" data-i18n-option="timeline_1_3">1-3 mesi</option>
                    <option value="3_6mo" data-i18n-option="timeline_3_6" selected>3-6 mesi</option>
                    <option value="6_12mo" data-i18n-option="timeline_6_12">6-12 mesi</option>
                    <option value="1plus_yr" data-i18n-option="timeline_1plus">1+ anno</option>
                </select>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 4: Exercise Experience -->
        <div class="step" id="step4">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step4_title">4. Esperienza di Esercizio</h2>
                <p class="step-desc" data-i18n="step4_desc">Livello di esperienza?</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="experience_level">Livello Esperienza</label>
                <select class="form-select" id="experience_level">
                    <option value="beginner" data-i18n="beginner">Principiante</option>
                    <option value="intermediate" data-i18n="intermediate">Intermedio</option>
                    <option value="advanced" data-i18n="advanced">Avanzato</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="exercise_frequency">Frequenza esercizio</label>
                <select class="form-select" id="exercise_frequency">
                    <option value="never" data-i18n-option="freq_never">Mai</option>
                    <option value="1_2_week" data-i18n-option="freq_1_2" selected>1-2 volte/settimana</option>
                    <option value="3_4_week" data-i18n-option="freq_3_4">3-4 volte/settimana</option>
                    <option value="5plus_week" data-i18n-option="freq_5plus">5+ volte/settimana</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="favorite_activities">Attivit√† preferite</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity_cardio" value="cardio" name="activities">
                        <label for="activity_cardio" data-i18n="cardio">Cardio</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity_weights" value="weights" name="activities">
                        <label for="activity_weights" data-i18n="weights">Pesi</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity_yoga" value="yoga" name="activities">
                        <label for="activity_yoga" data-i18n="yoga">Yoga</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity_sports" value="sports" name="activities">
                        <label for="activity_sports" data-i18n="sports">Sport</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="activity_classes" value="group_classes" name="activities">
                        <label for="activity_classes" data-i18n="group_classes">Classi di Gruppo</label>
                    </div>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 5: Nutrition -->
        <div class="step" id="step5">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step5_title">5. Nutrizione</h2>
                <p class="step-desc" data-i18n="step5_desc">Abitudini alimentari</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="diet_type">Tipo di dieta</label>
                <select class="form-select" id="diet_type">
                    <option value="omnivore" data-i18n-option="omnivore">Onnivora</option>
                    <option value="vegetarian" data-i18n-option="vegetarian">Vegetariana</option>
                    <option value="vegan" data-i18n-option="vegan">Vegana</option>
                    <option value="gluten_free" data-i18n-option="gluten_free">Senza Glutine</option>
                    <option value="keto" data-i18n-option="keto">Chetogenica</option>
                    <option value="other" data-i18n-option="diet_other">Altro</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="water_intake">Acqua giornaliera</label>
                <select class="form-select" id="water_intake">
                    <option value="less_1l" data-i18n-option="water_less_1">Meno di 1L</option>
                    <option value="1_2l" data-i18n-option="water_1_2" selected>1-2L</option>
                    <option value="2_3l" data-i18n-option="water_2_3">2-3L</option>
                    <option value="more_3l" data-i18n-option="water_more_3">Pi√π di 3L</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="food_restrictions">Restrizioni alimentari</label>
                <textarea class="form-textarea" id="food_restrictions"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="nutrition_goals">Obiettivi nutrizionali</label>
                <textarea class="form-textarea" id="nutrition_goals"></textarea>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 6: Lifestyle -->
        <div class="step" id="step6">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step6_title">6. Stile di Vita</h2>
                <p class="step-desc" data-i18n="step6_desc">Stile di vita quotidiano</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="sleep_quality">Qualit√† sonno (1-10)</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="sleep_quality" min="1" max="10" value="5" oninput="updateRangeValue('sleep_quality')">
                    <div class="range-value" id="sleep_quality_value">5</div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="stress_level">Livello stress (1-10)</label>
                <div class="range-container">
                    <input type="range" class="range-input" id="stress_level" min="1" max="10" value="5" oninput="updateRangeValue('stress_level')">
                    <div class="range-value" id="stress_level_value">5</div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="work_type">Tipo di lavoro</label>
                <select class="form-select" id="work_type">
                    <option value="sedentary" data-i18n-option="sedentary">Sedentario</option>
                    <option value="moderate" data-i18n-option="moderate">Moderatamente Attivo</option>
                    <option value="active" data-i18n-option="active">Molto Attivo</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="hobbies">Hobby</label>
                <textarea class="form-textarea" id="hobbies"></textarea>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 7: Body Measurements -->
        <div class="step" id="step7">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step7_title">7. Misurazioni Corporee</h2>
                <p class="step-desc" data-i18n="step7_desc">Composizione corporea</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="height">Altezza (cm)</label>
                <input type="number" class="form-input" id="height" placeholder="170" required>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="weight">Peso (kg)</label>
                <input type="number" class="form-input" id="weight" placeholder="70" step="0.1" required>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="waist">Vita (cm)</label>
                <input type="number" class="form-input" id="waist" step="0.1">
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="hips">Fianchi (cm)</label>
                <input type="number" class="form-input" id="hips" step="0.1">
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="chest">Petto (cm)</label>
                <input type="number" class="form-input" id="chest" step="0.1">
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="body_fat">Grasso Corporeo %</label>
                <input type="number" class="form-input" id="body_fat" step="0.1">
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 8: Motivation & Availability -->
        <div class="step" id="step8">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step8_title">8. Motivazione e Disponibilit√†</h2>
                <p class="step-desc" data-i18n="step8_desc">Quando e come lavorare?</p>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="session_preference">Preferenza sessioni</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="session_morning" value="morning" name="sessionPref">
                        <label for="session_morning" data-i18n="morning">Mattina</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="session_afternoon" value="afternoon" name="sessionPref">
                        <label for="session_afternoon" data-i18n="afternoon">Pomeriggio</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="session_evening" value="evening" name="sessionPref">
                        <label for="session_evening" data-i18n="evening">Sera</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="session_flexible" value="flexible" name="sessionPref">
                        <label for="session_flexible" data-i18n="flexible">Flessibile</label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="sessions_per_week">Sessioni/settimana</label>
                <select class="form-select" id="sessions_per_week">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3" selected>3</option>
                    <option value="4">4</option>
                    <option value="5+">5+</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="session_duration">Durata sessione</label>
                <select class="form-select" id="session_duration">
                    <option value="30min" data-i18n-option="duration_30">30 min</option>
                    <option value="45min" data-i18n-option="duration_45">45 min</option>
                    <option value="60min" data-i18n-option="duration_60" selected>60 min</option>
                    <option value="90min" data-i18n-option="duration_90">90 min</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="constraints">Vincoli o limitazioni?</label>
                <textarea class="form-textarea" id="constraints"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label" data-i18n="motivation">Cosa ti motiva?</label>
                <textarea class="form-textarea" id="motivation"></textarea>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-primary" onclick="nextStep()" data-i18n="next">Successivo ‚Üí</button>
            </div>
        </div>

        <!-- Step 9: Summary & Consent -->
        <div class="step" id="step9">
            <div class="step-header">
                <h2 class="step-title" data-i18n="step9_title">9. Riepilogo e Consenso</h2>
                <p class="step-desc" data-i18n="step9_desc">Controlla e dai il consenso</p>
            </div>
            <div id="summaryPreview"></div>
            <div class="form-group" style="margin-top: 24px;">
                <div class="checkbox-item">
                    <input type="checkbox" id="consent_accuracy" required>
                    <label for="consent_accuracy" data-i18n="consent">Confermo accuratezza dati</label>
                </div>
            </div>
            <div class="form-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="consent_privacy" required>
                    <label for="consent_privacy" data-i18n="privacy">Accetto politica privacy</label>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()" data-i18n="previous">‚Üê Precedente</button>
                <button class="btn btn-success" onclick="completeProfile()" data-i18n="complete">‚úì Completa Profilo</button>
            </div>
        </div>

        <!-- Success Section -->
        <div class="success-section" id="successSection">
            <div class="success-icon">üéâ</div>
            <h2 class="success-title" data-i18n="success_title">Profilo Creato!</h2>
            <div class="success-buttons">
                <button class="btn btn-success" onclick="downloadPDF()" data-i18n="download_pdf">üì• PDF</button>
                <button class="btn btn-accent" onclick="saveToJSONBin()" data-i18n="save_profile">üíæ Salva</button>
                <button class="btn btn-secondary" onclick="startOver()" data-i18n="start_over">Ricomincia</button>
            </div>
            <div class="summary-grid" id="finalSummary"></div>
        </div>
    </div>

    <script>
        // CONFIGURATION - Replace with your Master Key
        const JSONBIN_BIN_ID = '692abda043b1c97be9cc7ffb';
        const JSONBIN_API_KEY = '$2a$10$aMh1mO8btCVSqfcvlxvUJeJ6p.7kHJlSyKz7UjvTu2wqRAQlAcAXe';

        // Translations
        const translations = {
            it: {
                step1_title: "1. Informazioni Personali",
                step1_desc: "Iniziamo con i tuoi dati di base",
                fullname: "Nome Completo",
                email: "Email",
                phone: "Telefono",
                age: "Et√†",
                gender: "Genere",
                male: "Uomo",
                female: "Donna",
                other: "Altro",
                codice_fiscale: "Codice Fiscale",
                step2_title: "2. Storia Medica",
                step2_desc: "Informazioni sulla tua salute",
                medical_conditions: "Condizioni mediche?",
                medications: "Farmaci attuali",
                allergies: "Allergie",
                surgeries: "Interventi chirurgici",
                step3_title: "3. Obiettivi di Fitness",
                step3_desc: "Quali sono i tuoi obiettivi?",
                fitness_goals: "Seleziona obiettivi",
                weight_loss: "Perdere Peso",
                muscle_gain: "Aumentare Massa",
                strength: "Aumentare Forza",
                endurance: "Migliorare Resistenza",
                flexibility: "Migliorare Flessibilit√†",
                health: "Salute Generale",
                goal_importance: "Importanza obiettivi (1-10)",
                goal_timeline: "Timeline",
                step4_title: "4. Esperienza di Esercizio",
                step4_desc: "Livello di esperienza?",
                experience_level: "Livello Esperienza",
                beginner: "Principiante",
                intermediate: "Intermedio",
                advanced: "Avanzato",
                exercise_frequency: "Frequenza esercizio?",
                favorite_activities: "Attivit√† preferite?",
                step5_title: "5. Nutrizione",
                step5_desc: "Abitudini alimentari",
                diet_type: "Tipo di dieta?",
                water_intake: "Acqua giornaliera?",
                food_restrictions: "Restrizioni alimentari",
                nutrition_goals: "Obiettivi nutrizionali",
                step6_title: "6. Stile di Vita",
                step6_desc: "Stile di vita quotidiano",
                sleep_quality: "Qualit√† sonno (1-10)",
                stress_level: "Livello stress (1-10)",
                work_type: "Tipo di lavoro",
                hobbies: "Hobby",
                step7_title: "7. Misurazioni Corporee",
                step7_desc: "Composizione corporea",
                height: "Altezza (cm)",
                weight: "Peso (kg)",
                waist: "Vita (cm)",
                hips: "Fianchi (cm)",
                chest: "Petto (cm)",
                body_fat: "Grasso Corporeo %",
                step8_title: "8. Motivazione e Disponibilit√†",
                step8_desc: "Quando e come lavorare?",
                session_preference: "Preferenza sessioni",
                morning: "Mattina",
                afternoon: "Pomeriggio",
                evening: "Sera",
                flexible: "Flessibile",
                sessions_per_week: "Sessioni/settimana?",
                session_duration: "Durata sessione?",
                constraints: "Vincoli o limitazioni?",
                motivation: "Cosa ti motiva?",
                step9_title: "9. Riepilogo e Consenso",
                step9_desc: "Controlla e dai il consenso",
                consent: "Confermo accuratezza dati",
                privacy: "Accetto politica privacy",
                previous: "‚Üê Precedente",
                next: "Successivo ‚Üí",
                success_title: "Profilo Creato!",
                download_pdf: "üì• PDF",
                save_profile: "üíæ Salva",
                start_over: "Ricomincia",
                complete: "‚úì Completa Profilo"
            },
            en: {
                step1_title: "1. Personal Information",
                step1_desc: "Let's start with basic info",
                fullname: "Full Name",
                email: "Email",
                phone: "Phone",
                age: "Age",
                gender: "Gender",
                male: "Male",
                female: "Female",
                other: "Other",
                codice_fiscale: "Tax Code",
                step2_title: "2. Medical History",
                step2_desc: "Your health information",
                medical_conditions: "Medical conditions?",
                medications: "Current medications",
                allergies: "Allergies",
                surgeries: "Previous surgeries",
                step3_title: "3. Fitness Goals",
                step3_desc: "What are your goals?",
                fitness_goals: "Select goals",
                weight_loss: "Lose Weight",
                muscle_gain: "Gain Muscle",
                strength: "Increase Strength",
                endurance: "Improve Endurance",
                flexibility: "Improve Flexibility",
                health: "General Health",
                goal_importance: "Goal importance (1-10)",
                goal_timeline: "Timeline",
                step4_title: "4. Exercise Experience",
                step4_desc: "Exercise level?",
                experience_level: "Experience Level",
                beginner: "Beginner",
                intermediate: "Intermediate",
                advanced: "Advanced",
                exercise_frequency: "Exercise frequency?",
                favorite_activities: "Favorite activities?",
                step5_title: "5. Nutrition",
                step5_desc: "Eating habits",
                diet_type: "Diet type?",
                water_intake: "Daily water?",
                food_restrictions: "Food restrictions",
                nutrition_goals: "Nutrition goals",
                step6_title: "6. Lifestyle",
                step6_desc: "Daily lifestyle",
                sleep_quality: "Sleep quality (1-10)",
                stress_level: "Stress level (1-10)",
                work_type: "Work type",
                hobbies: "Hobbies",
                step7_title: "7. Body Measurements",
                step7_desc: "Body composition",
                height: "Height (cm)",
                weight: "Weight (kg)",
                waist: "Waist (cm)",
                hips: "Hips (cm)",
                chest: "Chest (cm)",
                body_fat: "Body Fat %",
                step8_title: "8. Motivation & Availability",
                step8_desc: "When and how to work?",
                session_preference: "Session preference",
                morning: "Morning",
                afternoon: "Afternoon",
                evening: "Evening",
                flexible: "Flexible",
                sessions_per_week: "Sessions/week?",
                session_duration: "Session duration?",
                constraints: "Constraints?",
                motivation: "What motivates you?",
                step9_title: "9. Summary & Consent",
                step9_desc: "Review and consent",
                consent: "I confirm accuracy",
                privacy: "I accept privacy",
                previous: "‚Üê Previous",
                next: "Next ‚Üí",
                success_title: "Profile Created!",
                download_pdf: "üì• PDF",
                save_profile: "üíæ Save",
                start_over: "Start Over",
                complete: "‚úì Complete Profile"
            }
        };

        // State
        let currentStep = 1;
        let currentLang = 'it';
        const totalSteps = 9;
        let formData = {};

        // Initialize
        updateProgress();
        updateRangeValue('goal_importance');
        updateRangeValue('sleep_quality');
        updateRangeValue('stress_level');
        setupConditionalCheckboxes();

        // Setup conditional checkbox behavior (none disables others)
        function setupConditionalCheckboxes() {
            const noneCheckbox = document.getElementById('condition_none');
            const otherConditions = document.querySelectorAll('input[name="conditions"]:not(#condition_none)');

            if (noneCheckbox) {
                noneCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        otherConditions.forEach(cb => {
                            cb.checked = false;
                            cb.disabled = true;
                        });
                    } else {
                        otherConditions.forEach(cb => cb.disabled = false);
                    }
                });

                otherConditions.forEach(cb => {
                    cb.addEventListener('change', function() {
                        if (this.checked && noneCheckbox.checked) {
                            noneCheckbox.checked = false;
                        }
                    });
                });
            }
        }

        // Language switching
        function switchLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            updateTranslations();
        }

        function updateTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'BUTTON') {
                        if (el.type === 'button' || el.tagName === 'BUTTON') {
                            el.textContent = translations[currentLang][key];
                        }
                    } else {
                        el.textContent = translations[currentLang][key];
                    }
                }
            });
            // Update select options
            updateSelectOptions();
        }

        function updateSelectOptions() {
            document.querySelectorAll('option[data-i18n-option]').forEach(option => {
                const key = option.getAttribute('data-i18n-option');
                if (translations[currentLang][key]) {
                    option.text = translations[currentLang][key];
                }
            });

            const experienceSelect = document.getElementById('experience_level');
            experienceSelect.options[0].text = translations[currentLang].beginner;
            experienceSelect.options[1].text = translations[currentLang].intermediate;
            experienceSelect.options[2].text = translations[currentLang].advanced;
        }

        // Navigation
        function nextStep() {
            if (validateCurrentStep()) {
                collectStepData();
                if (currentStep < totalSteps) {
                    document.getElementById(`step${currentStep}`).classList.remove('active');
                    currentStep++;
                    document.getElementById(`step${currentStep}`).classList.add('active');
                    updateProgress();
                    if (currentStep === 9) {
                        showSummaryPreview();
                    }
                    window.scrollTo(0, 0);
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
                window.scrollTo(0, 0);
            }
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Step ${currentStep} of ${totalSteps}`;
        }

        // Validation
        function validateCurrentStep() {
            const step = document.getElementById(`step${currentStep}`);
            const requiredInputs = step.querySelectorAll('[required]');

            for (let input of requiredInputs) {
                if (input.type === 'radio') {
                    const radioGroup = step.querySelectorAll(`input[name="${input.name}"]`);
                    const isChecked = Array.from(radioGroup).some(r => r.checked);
                    if (!isChecked) {
                        alert(currentLang === 'it' ? 'Per favore seleziona un\'opzione per tutti i campi obbligatori' : 'Please select an option for all required fields');
                        input.focus();
                        return false;
                    }
                } else if (input.type === 'checkbox' && input.hasAttribute('required') && !input.checked) {
                    alert(currentLang === 'it' ? 'Per favore accetta tutti i consensi richiesti' : 'Please check all required boxes');
                    return false;
                } else if (input.type !== 'checkbox' && input.type !== 'radio') {
                    if (!input.value.trim()) {
                        alert(currentLang === 'it' ? 'Per favore compila tutti i campi obbligatori' : 'Please fill in all required fields');
                        input.focus();
                        return false;
                    }
                }
            }

            return true;
        }

        // Data collection
        function collectStepData() {
            const step = document.getElementById(`step${currentStep}`);
            const inputs = step.querySelectorAll('input, select, textarea');

            // Clear arrays for re-collection
            const arrayFields = ['conditions', 'activities', 'sessionPref', 'fitnessGoals'];
            arrayFields.forEach(field => {
                if (formData[field]) formData[field] = [];
            });

            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    if (input.name) {
                        // Named checkbox groups (conditions, activities, sessionPref)
                        if (!formData[input.name]) formData[input.name] = [];
                        if (input.checked && input.value && !formData[input.name].includes(input.value)) {
                            formData[input.name].push(input.value);
                        }
                    } else if (input.id && input.id.startsWith('goal_')) {
                        // Fitness goals checkboxes
                        if (!formData.fitnessGoals) formData.fitnessGoals = [];
                        if (input.checked && input.value && !formData.fitnessGoals.includes(input.value)) {
                            formData.fitnessGoals.push(input.value);
                        }
                    } else if (input.id) {
                        // Individual checkboxes (consent)
                        formData[input.id] = input.checked;
                    }
                } else if (input.type === 'radio') {
                    if (input.checked) {
                        formData[input.name] = input.value;
                    }
                } else if (input.id) {
                    formData[input.id] = input.value;
                }
            });
        }

        // Range slider updates
        function updateRangeValue(id) {
            const input = document.getElementById(id);
            const display = document.getElementById(`${id}_value`);
            if (display) {
                display.textContent = input.value;
            }
        }

        // Helper function to format array values
        function formatArrayValue(arr) {
            if (!arr || arr.length === 0) return '-';
            return arr.map(v => {
                const key = Object.keys(translations[currentLang]).find(k =>
                    translations[currentLang][k].toLowerCase() === v.toLowerCase() ||
                    k === v.replace(/_/g, '')
                );
                return translations[currentLang][key] || v;
            }).join(', ');
        }

        // Helper function to format select values
        function formatSelectValue(value) {
            if (!value) return '-';
            const option = document.querySelector(`option[value="${value}"]`);
            return option ? option.text : value;
        }

        // Summary preview
        function showSummaryPreview() {
            const container = document.getElementById('summaryPreview');
            const labels = {
                it: {
                    personal: "Informazioni Personali",
                    health: "Storia Medica",
                    fitness: "Obiettivi Fitness",
                    experience: "Esperienza",
                    nutrition: "Nutrizione",
                    lifestyle: "Stile di Vita",
                    measurements: "Misurazioni",
                    motivation: "Motivazione"
                },
                en: {
                    personal: "Personal Info",
                    health: "Health History",
                    fitness: "Fitness Goals",
                    experience: "Experience",
                    nutrition: "Nutrition",
                    lifestyle: "Lifestyle",
                    measurements: "Measurements",
                    motivation: "Motivation"
                }
            };

            const l = labels[currentLang];
            const bmi = formData.height && formData.weight ?
                (formData.weight / Math.pow(formData.height / 100, 2)).toFixed(1) : '-';

            container.innerHTML = `
                <div class="summary-grid">
                    <div class="summary-card">
                        <h3 class="summary-card-title">${l.personal}</h3>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].fullname}</div><div class="summary-value">${formData.fullname || '-'}</div></div>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].email}</div><div class="summary-value">${formData.email || '-'}</div></div>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].age}</div><div class="summary-value">${formData.age || '-'} ${currentLang === 'it' ? 'anni' : 'years'}</div></div>
                    </div>
                    <div class="summary-card">
                        <h3 class="summary-card-title">${l.fitness}</h3>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].fitness_goals}</div><div class="summary-value">${formatArrayValue(formData.fitnessGoals)}</div></div>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].goal_importance}</div><div class="summary-value">${formData.goal_importance || '-'}/10</div></div>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].goal_timeline}</div><div class="summary-value">${formatSelectValue(formData.goal_timeline)}</div></div>
                    </div>
                    <div class="summary-card">
                        <h3 class="summary-card-title">${l.measurements}</h3>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].height}</div><div class="summary-value">${formData.height || '-'} cm</div></div>
                        <div class="summary-item"><div class="summary-label">${translations[currentLang].weight}</div><div class="summary-value">${formData.weight || '-'} kg</div></div>
                        <div class="summary-item"><div class="summary-label">BMI</div><div class="summary-value">${bmi}</div></div>
                    </div>
                </div>
            `;
        }

        // Complete profile
        function completeProfile() {
            if (!document.getElementById('consent_accuracy').checked ||
                !document.getElementById('consent_privacy').checked) {
                alert(currentLang === 'it' ? 'Per favore accetta tutti i consensi' : 'Please accept all consent boxes');
                return;
            }

            collectStepData();

            // Hide all steps and progress
            document.querySelectorAll('.step').forEach(step => step.style.display = 'none');
            document.querySelector('.progress-container').style.display = 'none';

            // Show success section
            document.getElementById('successSection').classList.add('active');

            // Generate final summary
            generateFinalSummary();

            window.scrollTo(0, 0);
        }

        // Generate final summary
        function generateFinalSummary() {
            const container = document.getElementById('finalSummary');
            const labels = {
                it: {
                    personal: "üìã Informazioni Personali",
                    health: "üè• Storia Medica",
                    fitness: "üéØ Obiettivi Fitness",
                    experience: "üí™ Esperienza",
                    nutrition: "ü•ó Nutrizione",
                    lifestyle: "üåü Stile di Vita",
                    measurements: "üìè Misurazioni",
                    motivation: "üî• Motivazione"
                },
                en: {
                    personal: "üìã Personal Info",
                    health: "üè• Health History",
                    fitness: "üéØ Fitness Goals",
                    experience: "üí™ Experience",
                    nutrition: "ü•ó Nutrition",
                    lifestyle: "üåü Lifestyle",
                    measurements: "üìè Measurements",
                    motivation: "üî• Motivation"
                }
            };

            const l = labels[currentLang];
            const bmi = formData.height && formData.weight ?
                (formData.weight / Math.pow(formData.height / 100, 2)).toFixed(1) : '-';

            container.innerHTML = `
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.personal}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].fullname}</div><div class="summary-value">${formData.fullname || '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].email}</div><div class="summary-value">${formData.email || '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].phone}</div><div class="summary-value">${formData.phone || '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].age}</div><div class="summary-value">${formData.age || '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].gender}</div><div class="summary-value">${formData.gender || '-'}</div></div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.health}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].medical_conditions}</div><div class="summary-value">${formatArrayValue(formData.conditions)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].medications}</div><div class="summary-value">${formData.medications || '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].allergies}</div><div class="summary-value">${formData.allergies || '-'}</div></div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.fitness}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].fitness_goals}</div><div class="summary-value">${formData.fitness_goals ? formData.fitness_goals.join(', ') : '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].goal_importance}</div><div class="summary-value">${formData.goal_importance || '-'}/10</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].goal_timeline}</div><div class="summary-value">${formData.goal_timeline || '-'}</div></div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.experience}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].experience_level}</div><div class="summary-value">${formatSelectValue(formData.experience_level)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].exercise_frequency}</div><div class="summary-value">${formatSelectValue(formData.exercise_frequency)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].favorite_activities}</div><div class="summary-value">${formatArrayValue(formData.activities)}</div></div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.nutrition}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].diet_type}</div><div class="summary-value">${formatSelectValue(formData.diet_type)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].water_intake}</div><div class="summary-value">${formatSelectValue(formData.water_intake)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].nutrition_goals}</div><div class="summary-value">${formData.nutrition_goals || '-'}</div></div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.lifestyle}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].sleep_quality}</div><div class="summary-value">${formData.sleep_quality || '-'}/10</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].stress_level}</div><div class="summary-value">${formData.stress_level || '-'}/10</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].work_type}</div><div class="summary-value">${formatSelectValue(formData.work_type)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].hobbies}</div><div class="summary-value">${formData.hobbies || '-'}</div></div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.measurements}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].height}</div><div class="summary-value">${formData.height || '-'} cm</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].weight}</div><div class="summary-value">${formData.weight || '-'} kg</div></div>
                    <div class="summary-item"><div class="summary-label">BMI</div><div class="summary-value">${bmi}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].waist}</div><div class="summary-value">${formData.waist ? formData.waist + ' cm' : '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].body_fat}</div><div class="summary-value">${formData.body_fat ? formData.body_fat + '%' : '-'}</div></div>
                </div>
                <div class="summary-card">
                    <h3 class="summary-card-title">${l.motivation}</h3>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].session_preference}</div><div class="summary-value">${formatArrayValue(formData.sessionPref)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].sessions_per_week}</div><div class="summary-value">${formData.sessions_per_week || '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].session_duration}</div><div class="summary-value">${formatSelectValue(formData.session_duration)}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].sessions_per_week}</div><div class="summary-value">${formData.sessions_per_week || '-'}</div></div>
                    <div class="summary-item"><div class="summary-label">${translations[currentLang].motivation}</div><div class="summary-value">${formData.motivation || '-'}</div></div>
                </div>
            `;
        }

        // Download PDF
        function downloadPDF() {
            const originalTitle = document.title;
            document.title = `Profile_${formData.fullname || 'Client'}_${new Date().toISOString().split('T')[0]}`;
            window.print();
            setTimeout(() => { document.title = originalTitle; }, 1000);
        }

        // Save to JSONBin - FIXED: Now appends profiles instead of overwriting
        async function saveToJSONBin() {
            if (JSONBIN_API_KEY === 'YOUR_MASTER_KEY_HERE') {
                alert(currentLang === 'it' ? '‚ö†Ô∏è Configura JSONBIN_API_KEY nella sezione JavaScript!' : '‚ö†Ô∏è Please configure JSONBIN_API_KEY in the JavaScript section first!');
                return;
            }

            const btn = event.target;
            btn.disabled = true;
            btn.textContent = currentLang === 'it' ? '‚è≥ Salvataggio...' : '‚è≥ Saving...';

            try {
                // STEP 1: Fetch existing data from JSONBin
                const getResponse = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });

                let profiles = [];
                if (getResponse.ok) {
                    const getData = await getResponse.json();
                    // Check if profiles array exists in the bin
                    profiles = getData.record.profiles || [];
                }

                // STEP 2: Append new profile to existing array
                profiles.push({
                    profile: formData,
                    timestamp: new Date().toISOString(),
                    language: currentLang
                });

                // STEP 3: Save all profiles back to JSONBin
                const putResponse = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify({ profiles: profiles })
                });

                if (putResponse.ok) {
                    alert(currentLang === 'it' ? '‚úÖ Profilo salvato con successo su JSONBin!' : '‚úÖ Profile saved successfully to JSONBin!');
                } else {
                    throw new Error('Failed to save');
                }
            } catch (error) {
                alert(currentLang === 'it' ? '‚ùå Errore nel salvataggio. Controlla la configurazione e riprova.' : '‚ùå Error saving to JSONBin. Please check your configuration and try again.');
                console.error('JSONBin error:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = translations[currentLang].save_profile;
            }
        }

        // Start over
        function startOver() {
            if (confirm(currentLang === 'it' ? 'Sei sicuro di voler ricominciare? Tutti i dati saranno persi.' : 'Are you sure you want to start over? All data will be lost.')) {
                formData = {};
                currentStep = 1;

                // Reset all form inputs
                document.querySelectorAll('input, select, textarea').forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });

                // Reset range values
                document.getElementById('goal_importance').value = 5;
                document.getElementById('sleep_quality').value = 5;
                document.getElementById('stress_level').value = 5;
                updateRangeValue('goal_importance');
                updateRangeValue('sleep_quality');
                updateRangeValue('stress_level');

                // Show first step
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                    step.style.display = '';
                });
                document.getElementById('step1').classList.add('active');

                // Hide success section
                document.getElementById('successSection').classList.remove('active');

                // Show progress bar
                document.querySelector('.progress-container').style.display = 'block';

                updateProgress();
                window.scrollTo(0, 0);
            }
        }
    </script>
</body>
</html>
